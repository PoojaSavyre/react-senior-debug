import{r as n,j as e}from"./vendor-react-BShjbBE1.js";import{u as M}from"./index-BatblRAa.js";import"./vendor-router-BBek9TLU.js";import"./shared-services-ARmQ2z6X.js";const F={low:{bg:"#f0fdf4",border:"#bbf7d0",text:"#166534"},medium:{bg:"#eff6ff",border:"#bfdbfe",text:"#1e40af"},high:{bg:"#fff7ed",border:"#fed7aa",text:"#9a3412"},critical:{bg:"#fef2f2",border:"#fecaca",text:"#991b1b"}},L={alert:"ðŸ””",notification:"ðŸ“¢",update:"ðŸ”„",warning:"âš ï¸",info:"â„¹ï¸"},O=n.memo(function({item:t}){const r=F[t.severity]||F.low,l=L[t.type]||"ðŸ“Œ",i=new Date(t.timestamp).toLocaleTimeString();return e.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid #f3f4f6",backgroundColor:r.bg,display:"flex",gap:"10px",alignItems:"flex-start"},children:[e.jsx("span",{style:{fontSize:"16px",flexShrink:0},children:l}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:"14px",color:"#1f2937",marginBottom:"4px"},children:t.message}),e.jsxs("div",{style:{display:"flex",gap:"12px",fontSize:"11px",color:"#6b7280"},children:[e.jsx("span",{children:i}),e.jsx("span",{style:{padding:"1px 6px",borderRadius:"10px",backgroundColor:r.border,color:r.text,fontWeight:"500"},children:t.severity}),e.jsx("span",{children:t.source})]})]})]})}),K=n.memo(function({filter:t,onChange:r}){const l=n.useCallback(o=>{r({...t,type:o.target.value})},[t,r]),i=n.useCallback(o=>{r({...t,severity:o.target.value})},[t,r]);return e.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"12px",padding:"10px",backgroundColor:"white",borderRadius:"6px",border:"1px solid #e5e7eb"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"12px",color:"#6b7280",display:"block",marginBottom:"4px"},children:"Type"}),e.jsxs("select",{value:t.type,onChange:l,style:z,children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"alert",children:"Alert"}),e.jsx("option",{value:"notification",children:"Notification"}),e.jsx("option",{value:"update",children:"Update"}),e.jsx("option",{value:"warning",children:"Warning"}),e.jsx("option",{value:"info",children:"Info"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"12px",color:"#6b7280",display:"block",marginBottom:"4px"},children:"Severity"}),e.jsxs("select",{value:t.severity,onChange:i,style:z,children:[e.jsx("option",{value:"all",children:"All Severities"}),e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]})]})}),z={padding:"6px 10px",border:"1px solid #d1d5db",borderRadius:"4px",fontSize:"13px",backgroundColor:"white",color:"#374151"},N=n.memo(function(){const{send:t,connected:r,authenticated:l}=M(),[i,o]=n.useState(""),c=n.useCallback(()=>{i.trim()&&(t("feed:send",{message:i.trim()}),o(""))},[i,t]),p=n.useCallback(u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),c())},[c]),a=r&&l&&i.trim();return e.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"12px",padding:"12px",backgroundColor:"white",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[e.jsx("input",{type:"text",value:i,onChange:u=>o(u.target.value),onKeyDown:p,placeholder:r?"Type a message...":"Connect to send messages",disabled:!r||!l,style:{flex:1,padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",outline:"none"}}),e.jsx("button",{onClick:c,disabled:!a,style:{padding:"8px 20px",backgroundColor:a?"#3b82f6":"#d1d5db",color:"white",border:"none",borderRadius:"6px",cursor:a?"pointer":"not-allowed",fontSize:"13px",fontWeight:"500"},children:"Send"})]})}),y=100,P=n.memo(function(){const{subscribe:t,send:r,connected:l,authenticated:i,reconnecting:o,reconnectAttempt:c,getState:p}=M(),[a,u]=n.useState([]),[h,B]=n.useState({type:"all",severity:"all"}),b=n.useRef(new Set),m=n.useRef(null),[j,k]=n.useState(!0),[I,D]=n.useState(null),[E,R]=n.useState(0),[T,A]=n.useState(0),C=n.useRef(-1);n.useEffect(()=>t("feed:message",d=>{if(!b.current.has(d.id)){if(b.current.add(d.id),R(f=>{const v=f+1;return d.sequence!==void 0&&d.sequence<=C.current&&A(w=>w+1),d.sequence!==void 0&&(C.current=d.sequence),v}),b.current.size>y*2){const f=Array.from(b.current);b.current=new Set(f.slice(-y))}u(f=>{const v=[...f,{...d,receivedAt:Date.now()}];return v.length>y?v.slice(-y):v})}}),[t]),n.useEffect(()=>{const s=t("heartbeat:missed",f=>{console.warn("[LiveFeed] Heartbeat missed:",f)}),d=t("heartbeat:dead",()=>{console.error("[LiveFeed] Connection dead - heartbeat timeout")});return()=>{s(),d()}},[t]),n.useEffect(()=>{const s=setInterval(()=>{const d=p();d&&D(d)},2e3);return()=>clearInterval(s)},[p]),n.useEffect(()=>{j&&m.current&&(m.current.scrollTop=m.current.scrollHeight)},[a.length,j]);const q=n.useCallback(()=>{const s=m.current;if(!s)return;const d=s.scrollHeight-s.scrollTop-s.clientHeight<50;k(d)},[]),H=n.useCallback(s=>{B(s)},[]),W=n.useCallback(()=>{u([]),b.current.clear(),R(0),A(0),C.current=-1},[]),S=a.filter(s=>!(h.type!=="all"&&s.type!==h.type||h.severity!=="all"&&s.severity!==h.severity));return e.jsxs("div",{style:{padding:"20px",display:"flex",flexDirection:"column",height:"calc(100vh - 120px)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h2",{style:{margin:0,fontSize:"24px",color:"#111827"},children:"Live Feed"}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[e.jsxs("span",{style:{fontSize:"12px",color:"#6b7280"},children:[S.length," messages"]}),e.jsx("button",{onClick:W,style:$,children:"Clear"})]})]}),e.jsx(_,{connected:l,authenticated:i,reconnecting:o,reconnectAttempt:c,wsStats:I,messageSequence:E,outOfOrderCount:T}),e.jsx(K,{filter:h,onChange:H}),!l&&e.jsx("div",{style:{padding:"12px",backgroundColor:"#fef3c7",border:"1px solid #fde68a",borderRadius:"6px",marginBottom:"12px",fontSize:"13px",color:"#92400e"},children:o?`Reconnecting... (attempt ${c})`:"WebSocket disconnected. Messages will resume when connection is restored."}),e.jsx("div",{ref:m,onScroll:q,style:{flex:1,overflowY:"auto",border:"1px solid #e5e7eb",borderRadius:"8px",backgroundColor:"#fafafa"},children:S.length===0?e.jsx("div",{style:{padding:"40px",textAlign:"center",color:"#9ca3af"},children:l&&i?"Waiting for messages...":"Connect to see live messages"}):S.map(s=>e.jsx(O,{item:s},s.id))}),!j&&e.jsx("button",{onClick:()=>k(!0),style:{position:"relative",bottom:"50px",alignSelf:"center",padding:"6px 16px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"20px",cursor:"pointer",fontSize:"12px",boxShadow:"0 2px 8px rgba(59, 130, 246, 0.4)"},children:"Scroll to latest"}),e.jsx(N,{})]})}),_=n.memo(function({connected:t,authenticated:r,reconnecting:l,reconnectAttempt:i,wsStats:o,messageSequence:c,outOfOrderCount:p}){const a=o!=null&&o.lastHeartbeatAt?Math.round((Date.now()-o.lastHeartbeatAt)/1e3):null;return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(130px, 1fr))",gap:"8px",marginBottom:"12px"},children:[e.jsx(x,{label:"Connection",value:t?"Connected":l?"Reconnecting":"Disconnected",color:t?"#059669":l?"#d97706":"#dc2626"}),e.jsx(x,{label:"Auth",value:r?"Authenticated":"Not Auth",color:r?"#059669":"#6b7280"}),e.jsx(x,{label:"Messages",value:c,color:"#3b82f6"}),e.jsx(x,{label:"Out of Order",value:p,color:p>0?"#dc2626":"#059669"}),e.jsx(x,{label:"Queued",value:(o==null?void 0:o.queuedMessages)??0,color:"#6b7280"}),e.jsx(x,{label:"Heartbeat",value:a!==null?`${a}s ago`:"N/A",color:a!==null&&a>60?"#dc2626":"#059669"}),e.jsx(x,{label:"HB Misses",value:(o==null?void 0:o.heartbeatMissCount)??0,color:(o==null?void 0:o.heartbeatMissCount)>0?"#f59e0b":"#059669"}),l&&e.jsx(x,{label:"Reconnect #",value:i,color:"#d97706"})]})}),x=n.memo(function({label:t,value:r,color:l}){return e.jsxs("div",{style:{padding:"8px 10px",backgroundColor:"#f9fafb",borderRadius:"6px",border:"1px solid #e5e7eb"},children:[e.jsx("div",{style:{fontSize:"10px",color:"#6b7280",marginBottom:"2px"},children:t}),e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:l},children:String(r)})]})}),$={padding:"6px 12px",border:"1px solid #d1d5db",borderRadius:"4px",backgroundColor:"white",cursor:"pointer",fontSize:"12px",color:"#374151"};function G(){return e.jsx(P,{})}export{G as default};
//# sourceMappingURL=LiveFeedPage-BH2tw1Mq.js.map
