{"version":3,"mappings":"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","names":["ErrorBoundary","React","props","__publicField","error","errorInfo","jsxs","jsx","_a","styles","SuspenseFallback","level","message","SkeletonCard","width","height","SkeletonList","count","itemHeight","_","i","SkeletonDashboard","SuspenseBoundary","children","fallback","errorFallback","onError","onReset","suspenseKey","fallbackUI","Suspense","useInterval","callback","delay","savedCallback","useRef","useEffect","id","PerformanceContext","createContext","PerformanceProvider","trackingEnabled","globalMetrics","setGlobalMetrics","useState","renderLogRef","trackRender","useCallback","componentName","renderTime","prev","getRenderLog","limit","log","e","resetMetrics","value","useMemo","usePerformanceContext","context","useContext","EventLoopMonitor","options","recent","avgLag","sum","s","now","expected","actual","lag","sample","recentSamples","event","set","data","handlers","handler","err","useEventLoopHealth","sampleInterval","enabled","health","setHealth","monitorRef","monitor","unsubSample","stats","score","reset","getSamples","PerformanceOverlay","memo","isExpanded","setIsExpanded","perfMetrics","eventLoopHealth","toggle","containerStyle","MetricRow","Fragment","label","warn","WS_STATES","WebSocketManager","url","code","reason","type","payload","buffer","text","elapsed","sequenceNum","EMPTY_PROTOCOLS","useWebSocket","authToken","autoConnect","onMessage","onOpen","onClose","protocols","reconnectAttempts","connectionState","setConnectionState","lastMessage","setLastMessage","onMessageRef","onOpenRef","onCloseRef","onErrorRef","managerRef","wsConfig","attempt","manager","send","subscribe","messageType","connect","disconnect","getState","WebSocketContext","WebSocketProvider","messages","setMessages","handleMessage","updated","ws","clearMessages","useWebSocketContext","CacheContext","CacheProvider","forceUpdate","cache","CacheManager","invalidator","inv","CacheInvalidator","invalidateAndRefresh","resourceType","mutationType","n","WS_URL","AUTH_TOKEN","DashboardPage","lazy","LiveFeedPage","UsersPage","AnalyticsPage","SettingsPage","AppLayout","location","useLocation","Sidebar","currentPath","navItems","item","isActive","Link","LazyRoute","App","BrowserRouter","Routes","Route","root","ReactDOM"],"ignoreList":[],"sources":["../../src/components/common/ErrorBoundary.jsx","../../src/components/common/SuspenseFallback.jsx","../../src/components/common/SuspenseBoundary.jsx","../../src/hooks/useInterval.js","../../src/context/PerformanceContext.jsx","../../src/services/eventLoop/EventLoopMonitor.js","../../src/hooks/useEventLoopHealth.js","../../src/components/common/PerformanceOverlay.jsx","../../src/services/websocket/WebSocketManager.js","../../src/hooks/useWebSocket.js","../../src/context/WebSocketContext.jsx","../../src/context/CacheContext.jsx","../../src/App.jsx","../../src/main.jsx"],"sourcesContent":["/**\r\n * ErrorBoundary - Catches rendering errors and displays fallback UI.\r\n *\r\n * Competency: React Suspense Implementation, React Component Suspense Management\r\n * Bug surface: suspense not catching errors, missing error boundary with suspense,\r\n *              boundary error propagation, boundary unmounting issues\r\n */\r\n\r\nimport React from 'react';\r\n\r\nclass ErrorBoundary extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      hasError: false,\r\n      error: null,\r\n      errorInfo: null,\r\n    };\r\n  }\r\n\r\n  static getDerivedStateFromError(error) {\r\n    return { hasError: true, error };\r\n  }\r\n\r\n  componentDidCatch(error, errorInfo) {\r\n    this.setState({ errorInfo });\r\n\r\n    if (this.props.onError) {\r\n      this.props.onError(error, errorInfo);\r\n    }\r\n\r\n    console.error('[ErrorBoundary] Caught error:', error, errorInfo);\r\n  }\r\n\r\n  handleReset = () => {\r\n    this.setState({ hasError: false, error: null, errorInfo: null });\r\n\r\n    if (this.props.onReset) {\r\n      this.props.onReset();\r\n    }\r\n  };\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      if (this.props.fallback) {\r\n        return this.props.fallback({\r\n          error: this.state.error,\r\n          errorInfo: this.state.errorInfo,\r\n          reset: this.handleReset,\r\n        });\r\n      }\r\n\r\n      return (\r\n        <div\r\n          role=\"alert\"\r\n          style={{\r\n            padding: '20px',\r\n            margin: '10px',\r\n            borderRadius: '8px',\r\n            backgroundColor: '#fef2f2',\r\n            border: '1px solid #fecaca',\r\n            color: '#991b1b',\r\n          }}\r\n        >\r\n          <h3 style={{ margin: '0 0 8px 0', fontSize: '16px' }}>Something went wrong</h3>\r\n          <p style={{ margin: '0 0 12px 0', fontSize: '14px', color: '#b91c1c' }}>\r\n            {this.state.error?.message || 'An unexpected error occurred'}\r\n          </p>\r\n          <button\r\n            onClick={this.handleReset}\r\n            style={{\r\n              padding: '8px 16px',\r\n              backgroundColor: '#dc2626',\r\n              color: 'white',\r\n              border: 'none',\r\n              borderRadius: '6px',\r\n              cursor: 'pointer',\r\n              fontSize: '13px',\r\n            }}\r\n          >\r\n            Try Again\r\n          </button>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\nexport { ErrorBoundary };\r\n","/**\r\n * SuspenseFallback - Accessible loading fallback UIs that prevent layout shifts.\r\n *\r\n * Competency: React Component Suspense Management, React Suspense Implementation\r\n * Bug surface: missing fallback UI, fallback not accessible, layout shifts,\r\n *              inconsistent fallback UI, fallback not rendering\r\n */\r\n\r\nimport React from 'react';\r\n\r\nconst styles = {\r\n  container: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    padding: '20px',\r\n    minHeight: '100px',\r\n  },\r\n  page: {\r\n    minHeight: '400px',\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: '16px',\r\n  },\r\n  spinner: {\r\n    width: '32px',\r\n    height: '32px',\r\n    border: '3px solid #e5e7eb',\r\n    borderTopColor: '#3b82f6',\r\n    borderRadius: '50%',\r\n    animation: 'spin 0.8s linear infinite',\r\n  },\r\n  skeleton: {\r\n    backgroundColor: '#f3f4f6',\r\n    borderRadius: '6px',\r\n    animation: 'pulse 1.5s ease-in-out infinite',\r\n  },\r\n  text: {\r\n    fontSize: '14px',\r\n    color: '#6b7280',\r\n    margin: 0,\r\n  },\r\n};\r\n\r\nfunction SuspenseFallback({ level = 'section', message = 'Loading...' }) {\r\n  return (\r\n    <div\r\n      role=\"status\"\r\n      aria-busy=\"true\"\r\n      aria-label={message}\r\n      style={level === 'page' ? styles.page : styles.container}\r\n    >\r\n      <div style={styles.spinner} />\r\n      <p style={styles.text}>{message}</p>\r\n      <style>{`\r\n        @keyframes spin { to { transform: rotate(360deg); } }\r\n        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction SkeletonCard({ width = '100%', height = '120px' }) {\r\n  return (\r\n    <div\r\n      role=\"status\"\r\n      aria-busy=\"true\"\r\n      aria-label=\"Loading content\"\r\n      style={{\r\n        ...styles.skeleton,\r\n        width,\r\n        height,\r\n      }}\r\n    />\r\n  );\r\n}\r\n\r\nfunction SkeletonList({ count = 5, itemHeight = '60px' }) {\r\n  return (\r\n    <div role=\"status\" aria-busy=\"true\" aria-label=\"Loading list\" style={{ display: 'flex', flexDirection: 'column', gap: '8px', padding: '10px' }}>\r\n      {Array.from({ length: count }, (_, i) => (\r\n        <div\r\n          key={i}\r\n          style={{\r\n            ...styles.skeleton,\r\n            width: '100%',\r\n            height: itemHeight,\r\n          }}\r\n        />\r\n      ))}\r\n      <style>{`\r\n        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction SkeletonDashboard() {\r\n  return (\r\n    <div\r\n      role=\"status\"\r\n      aria-busy=\"true\"\r\n      aria-label=\"Loading dashboard\"\r\n      style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(250px, 1fr))', gap: '16px', padding: '20px' }}\r\n    >\r\n      {Array.from({ length: 6 }, (_, i) => (\r\n        <SkeletonCard key={i} height=\"140px\" />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport { SuspenseFallback, SkeletonCard, SkeletonList, SkeletonDashboard };\r\n","/**\r\n * SuspenseBoundary - Composed Suspense + ErrorBoundary wrapper.\r\n * Provides proper boundary placement with accessible fallback.\r\n *\r\n * Competency: React Suspense Implementation, React Component Suspense Management\r\n * Bug surface: missing suspense boundary, nested boundary conflicts,\r\n *              fallback not rendering, key prop missing, boundary placement issues\r\n */\r\n\r\nimport React, { Suspense } from 'react';\r\nimport { ErrorBoundary } from './ErrorBoundary';\r\nimport { SuspenseFallback } from './SuspenseFallback';\r\n\r\nfunction SuspenseBoundary({\r\n  children,\r\n  fallback = null,\r\n  errorFallback = null,\r\n  onError = null,\r\n  onReset = null,\r\n  suspenseKey = undefined,\r\n  level = 'section',\r\n}) {\r\n  const fallbackUI = fallback || <SuspenseFallback level={level} />;\r\n\r\n  return (\r\n    <ErrorBoundary\r\n      fallback={errorFallback || undefined}\r\n      onError={onError}\r\n      onReset={onReset}\r\n    >\r\n      <Suspense key={suspenseKey} fallback={fallbackUI}>\r\n        {children}\r\n      </Suspense>\r\n    </ErrorBoundary>\r\n  );\r\n}\r\n\r\nexport { SuspenseBoundary };\r\n","/**\r\n * useInterval - Safe interval hook with proper cleanup and no stale closures.\r\n *\r\n * Competency: React Hook Dependencies\r\n * Bug surface: stale closure in callback, hook effect dependency timing,\r\n *              memory leaks, effect cleanup dependencies\r\n */\r\n\r\nimport { useEffect, useRef } from 'react';\r\n\r\n/**\r\n * Dan Abramov's useInterval pattern.\r\n * The callback is stored in a ref so the interval always calls\r\n * the latest version without needing to restart the interval.\r\n */\r\nfunction useInterval(callback, delay) {\r\n  const savedCallback = useRef(callback);\r\n\r\n  // Remember the latest callback without restarting the interval\r\n  useEffect(() => {\r\n    savedCallback.current = callback;\r\n  }, [callback]);\r\n\r\n  // Set up the interval\r\n  useEffect(() => {\r\n    if (delay === null || delay === undefined) {\r\n      return; // Paused\r\n    }\r\n\r\n    const tick = () => {\r\n      savedCallback.current();\r\n    };\r\n\r\n    const id = setInterval(tick, delay);\r\n\r\n    return () => {\r\n      clearInterval(id);\r\n    };\r\n  }, [delay]);\r\n}\r\n\r\nexport { useInterval };\r\n","/**\r\n * PerformanceContext - Provides performance monitoring to the component tree.\r\n *\r\n * Competency: React Performance Analysis\r\n * Bug surface: untracked metrics, performance context overhead\r\n */\r\n\r\nimport React, { createContext, useContext, useMemo, useCallback, useState, useRef } from 'react';\r\nimport { useInterval } from '../hooks/useInterval';\r\n\r\nconst PerformanceContext = createContext(null);\r\n\r\nfunction PerformanceProvider({ children, trackingEnabled = true }) {\r\n  const [globalMetrics, setGlobalMetrics] = useState({\r\n    componentRenderCounts: {},\r\n    totalRenders: 0,\r\n    slowRenders: 0,\r\n    memoryUsage: null,\r\n  });\r\n\r\n  const renderLogRef = useRef([]);\r\n\r\n  const trackRender = useCallback((componentName, renderTime) => {\r\n    renderLogRef.current.push({\r\n      component: componentName,\r\n      time: renderTime,\r\n      timestamp: Date.now(),\r\n    });\r\n\r\n    // Keep bounded\r\n    if (renderLogRef.current.length > 500) {\r\n      renderLogRef.current = renderLogRef.current.slice(-500);\r\n    }\r\n\r\n    setGlobalMetrics((prev) => ({\r\n      ...prev,\r\n      totalRenders: prev.totalRenders + 1,\r\n      slowRenders: renderTime > 16 ? prev.slowRenders + 1 : prev.slowRenders,\r\n      componentRenderCounts: {\r\n        ...prev.componentRenderCounts,\r\n        [componentName]: (prev.componentRenderCounts[componentName] || 0) + 1,\r\n      },\r\n    }));\r\n  }, []);\r\n\r\n  // Periodically check memory usage\r\n  useInterval(() => {\r\n    if (trackingEnabled && performance.memory) {\r\n      setGlobalMetrics((prev) => ({\r\n        ...prev,\r\n        memoryUsage: {\r\n          usedJSHeapSize: Math.round(performance.memory.usedJSHeapSize / 1048576),\r\n          totalJSHeapSize: Math.round(performance.memory.totalJSHeapSize / 1048576),\r\n          jsHeapSizeLimit: Math.round(performance.memory.jsHeapSizeLimit / 1048576),\r\n        },\r\n      }));\r\n    }\r\n  }, trackingEnabled ? 5000 : null);\r\n\r\n  const getRenderLog = useCallback((componentName, limit = 20) => {\r\n    const log = renderLogRef.current;\r\n    if (componentName) {\r\n      return log.filter((e) => e.component === componentName).slice(-limit);\r\n    }\r\n    return log.slice(-limit);\r\n  }, []);\r\n\r\n  const resetMetrics = useCallback(() => {\r\n    renderLogRef.current = [];\r\n    setGlobalMetrics({\r\n      componentRenderCounts: {},\r\n      totalRenders: 0,\r\n      slowRenders: 0,\r\n      memoryUsage: null,\r\n    });\r\n  }, []);\r\n\r\n  const value = useMemo(\r\n    () => ({\r\n      metrics: globalMetrics,\r\n      trackRender,\r\n      getRenderLog,\r\n      resetMetrics,\r\n      trackingEnabled,\r\n    }),\r\n    [globalMetrics, trackRender, getRenderLog, resetMetrics, trackingEnabled]\r\n  );\r\n\r\n  return (\r\n    <PerformanceContext.Provider value={value}>\r\n      {children}\r\n    </PerformanceContext.Provider>\r\n  );\r\n}\r\n\r\nfunction usePerformanceContext() {\r\n  const context = useContext(PerformanceContext);\r\n  if (!context) {\r\n    throw new Error('usePerformanceContext must be used within a PerformanceProvider');\r\n  }\r\n  return context;\r\n}\r\n\r\nexport { PerformanceProvider, usePerformanceContext, PerformanceContext };\r\n","/**\r\n * EventLoopMonitor - Monitors event loop health, detects lag, stalls, and blocking.\r\n *\r\n * Competencies: Event Loop Optimization, Event Loop Understanding\r\n * Bug surface: blocking operations, starvation, lag detection, phase confusion,\r\n *              microtask flooding, priority inversion, memory accumulation\r\n */\r\n\r\nclass EventLoopMonitor {\r\n  constructor(options = {}) {\r\n    this.sampleInterval = options.sampleInterval || 100;\r\n    this.lagThreshold = options.lagThreshold || 50;\r\n    this.stallThreshold = options.stallThreshold || 200;\r\n    this.maxSamples = options.maxSamples || 1000;\r\n\r\n    this.samples = [];\r\n    this.listeners = new Map();\r\n    this.monitorTimer = null;\r\n    this.lastTick = 0;\r\n    this.isRunning = false;\r\n\r\n    this.stats = {\r\n      totalSamples: 0,\r\n      lagSpikes: 0,\r\n      stalls: 0,\r\n      maxLag: 0,\r\n      avgLag: 0,\r\n      currentLag: 0,\r\n    };\r\n  }\r\n\r\n  start() {\r\n    if (this.isRunning) return;\r\n    this.isRunning = true;\r\n    this.lastTick = performance.now();\r\n    this._tick();\r\n  }\r\n\r\n  stop() {\r\n    this.isRunning = false;\r\n    if (this.monitorTimer) {\r\n      clearTimeout(this.monitorTimer);\r\n      this.monitorTimer = null;\r\n    }\r\n  }\r\n\r\n  onLagSpike(callback) {\r\n    return this._addListener('lagSpike', callback);\r\n  }\r\n\r\n  onStall(callback) {\r\n    return this._addListener('stall', callback);\r\n  }\r\n\r\n  onSample(callback) {\r\n    return this._addListener('sample', callback);\r\n  }\r\n\r\n  getStats() {\r\n    return { ...this.stats };\r\n  }\r\n\r\n  getSamples(count) {\r\n    return this.samples.slice(-(count || this.samples.length));\r\n  }\r\n\r\n  getHealthScore() {\r\n    if (this.samples.length === 0) return 100;\r\n\r\n    const recent = this.samples.slice(-50);\r\n    const avgLag = recent.reduce((sum, s) => sum + s.lag, 0) / recent.length;\r\n\r\n    // Score: 100 = perfect, 0 = completely blocked\r\n    if (avgLag < 5) return 100;\r\n    if (avgLag < 16) return 90;\r\n    if (avgLag < 33) return 75;\r\n    if (avgLag < 50) return 60;\r\n    if (avgLag < 100) return 40;\r\n    if (avgLag < 200) return 20;\r\n    return 10;\r\n  }\r\n\r\n  reset() {\r\n    this.samples = [];\r\n    this.stats = {\r\n      totalSamples: 0,\r\n      lagSpikes: 0,\r\n      stalls: 0,\r\n      maxLag: 0,\r\n      avgLag: 0,\r\n      currentLag: 0,\r\n    };\r\n  }\r\n\r\n  destroy() {\r\n    this.stop();\r\n    this.listeners.clear();\r\n    this.samples = [];\r\n  }\r\n\r\n  // Private\r\n\r\n  _tick() {\r\n    if (!this.isRunning) return;\r\n\r\n    const now = performance.now();\r\n    const expected = this.sampleInterval;\r\n    const actual = now - this.lastTick;\r\n    const lag = Math.max(0, actual - expected);\r\n\r\n    this.lastTick = now;\r\n\r\n    const sample = {\r\n      timestamp: Date.now(),\r\n      expected,\r\n      actual: Math.round(actual * 100) / 100,\r\n      lag: Math.round(lag * 100) / 100,\r\n    };\r\n\r\n    this._recordSample(sample);\r\n\r\n    // Schedule next tick\r\n    this.monitorTimer = setTimeout(() => this._tick(), this.sampleInterval);\r\n  }\r\n\r\n  _recordSample(sample) {\r\n    // Maintain bounded sample array\r\n    if (this.samples.length >= this.maxSamples) {\r\n      this.samples.shift();\r\n    }\r\n    this.samples.push(sample);\r\n\r\n    // Update stats\r\n    this.stats.totalSamples++;\r\n    this.stats.currentLag = sample.lag;\r\n    this.stats.maxLag = Math.max(this.stats.maxLag, sample.lag);\r\n\r\n    // Running average\r\n    const recentSamples = this.samples.slice(-100);\r\n    this.stats.avgLag =\r\n      Math.round(\r\n        (recentSamples.reduce((sum, s) => sum + s.lag, 0) / recentSamples.length) * 100\r\n      ) / 100;\r\n\r\n    // Emit events\r\n    this._emit('sample', sample);\r\n\r\n    if (sample.lag > this.stallThreshold) {\r\n      this.stats.stalls++;\r\n      this._emit('stall', sample);\r\n    } else if (sample.lag > this.lagThreshold) {\r\n      this.stats.lagSpikes++;\r\n      this._emit('lagSpike', sample);\r\n    }\r\n  }\r\n\r\n  _addListener(event, callback) {\r\n    if (!this.listeners.has(event)) {\r\n      this.listeners.set(event, new Set());\r\n    }\r\n    this.listeners.get(event).add(callback);\r\n\r\n    return () => {\r\n      const set = this.listeners.get(event);\r\n      if (set) {\r\n        set.delete(callback);\r\n      }\r\n    };\r\n  }\r\n\r\n  _emit(event, data) {\r\n    const handlers = this.listeners.get(event);\r\n    if (handlers) {\r\n      handlers.forEach((handler) => {\r\n        try {\r\n          handler(data);\r\n        } catch (err) {\r\n          console.error(`[EventLoopMonitor] Listener error for ${event}:`, err);\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport { EventLoopMonitor };\r\n","/**\r\n * useEventLoopHealth - React hook that monitors event loop health.\r\n *\r\n * Competency: Event Loop Optimization, React Hook Dependencies\r\n * Bug surface: timer deps, memory leaks from accumulated callbacks,\r\n *              effect cleanup, blocking detection\r\n */\r\n\r\nimport { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { EventLoopMonitor } from '../services/eventLoop/EventLoopMonitor';\r\n\r\nfunction useEventLoopHealth(options = {}) {\r\n  const { sampleInterval = 200, enabled = true } = options;\r\n\r\n  const [health, setHealth] = useState({\r\n    score: 100,\r\n    currentLag: 0,\r\n    avgLag: 0,\r\n    maxLag: 0,\r\n    lagSpikes: 0,\r\n    stalls: 0,\r\n    isHealthy: true,\r\n  });\r\n\r\n  const monitorRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (!enabled) return;\r\n\r\n    const monitor = new EventLoopMonitor({ sampleInterval });\r\n    monitorRef.current = monitor;\r\n\r\n    // Subscribe to samples\r\n    const unsubSample = monitor.onSample(() => {\r\n      const stats = monitor.getStats();\r\n      const score = monitor.getHealthScore();\r\n\r\n      setHealth({\r\n        score,\r\n        currentLag: stats.currentLag,\r\n        avgLag: stats.avgLag,\r\n        maxLag: stats.maxLag,\r\n        lagSpikes: stats.lagSpikes,\r\n        stalls: stats.stalls,\r\n        isHealthy: score > 60,\r\n      });\r\n    });\r\n\r\n    monitor.start();\r\n\r\n    return () => {\r\n      unsubSample();\r\n      monitor.destroy();\r\n      monitorRef.current = null;\r\n    };\r\n  }, [sampleInterval, enabled]);\r\n\r\n  const reset = useCallback(() => {\r\n    if (monitorRef.current) {\r\n      monitorRef.current.reset();\r\n      setHealth({\r\n        score: 100,\r\n        currentLag: 0,\r\n        avgLag: 0,\r\n        maxLag: 0,\r\n        lagSpikes: 0,\r\n        stalls: 0,\r\n        isHealthy: true,\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  const getSamples = useCallback((count = 50) => {\r\n    if (monitorRef.current) {\r\n      return monitorRef.current.getSamples(count);\r\n    }\r\n    return [];\r\n  }, []);\r\n\r\n  return { ...health, reset, getSamples };\r\n}\r\n\r\nexport { useEventLoopHealth };\r\n","/**\r\n * PerformanceOverlay - Dev overlay showing performance metrics, render counts.\r\n *\r\n * Competency: React Performance Analysis\r\n * Bug surface: untracked metrics, stale props causing performance issues\r\n */\r\n\r\nimport React, { useState, memo, useCallback } from 'react';\r\nimport { usePerformanceContext } from '../../context/PerformanceContext';\r\nimport { useEventLoopHealth } from '../../hooks/useEventLoopHealth';\r\n\r\nconst PerformanceOverlay = memo(function PerformanceOverlay() {\r\n  const [isExpanded, setIsExpanded] = useState(false);\r\n  const { metrics: perfMetrics } = usePerformanceContext();\r\n  const eventLoopHealth = useEventLoopHealth({ enabled: isExpanded });\r\n\r\n  const toggle = useCallback(() => {\r\n    setIsExpanded((prev) => !prev);\r\n  }, []);\r\n\r\n  const containerStyle = {\r\n    position: 'fixed',\r\n    bottom: '10px',\r\n    right: '10px',\r\n    zIndex: 9999,\r\n    fontFamily: 'monospace',\r\n    fontSize: '12px',\r\n    backgroundColor: 'rgba(0, 0, 0, 0.85)',\r\n    color: '#e5e7eb',\r\n    borderRadius: '8px',\r\n    boxShadow: '0 4px 12px rgba(0, 0, 0, 0.3)',\r\n    maxWidth: isExpanded ? '320px' : '44px',\r\n    overflow: 'hidden',\r\n    transition: 'max-width 0.2s ease',\r\n  };\r\n\r\n  if (!isExpanded) {\r\n    return (\r\n      <div style={containerStyle}>\r\n        <button\r\n          onClick={toggle}\r\n          style={{\r\n            width: '44px',\r\n            height: '44px',\r\n            border: 'none',\r\n            background: 'transparent',\r\n            color: '#10b981',\r\n            cursor: 'pointer',\r\n            fontSize: '18px',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n          }}\r\n          title=\"Performance Monitor\"\r\n        >\r\n          ⚡\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={containerStyle}>\r\n      <div style={{ padding: '12px' }}>\r\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '10px' }}>\r\n          <span style={{ fontWeight: 'bold', color: '#10b981' }}>⚡ Performance</span>\r\n          <button\r\n            onClick={toggle}\r\n            style={{\r\n              border: 'none',\r\n              background: 'transparent',\r\n              color: '#9ca3af',\r\n              cursor: 'pointer',\r\n              fontSize: '14px',\r\n            }}\r\n          >\r\n            ✕\r\n          </button>\r\n        </div>\r\n\r\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '6px' }}>\r\n          <MetricRow label=\"Total Renders\" value={perfMetrics.totalRenders} />\r\n          <MetricRow label=\"Slow Renders\" value={perfMetrics.slowRenders} warn={perfMetrics.slowRenders > 5} />\r\n\r\n          <div style={{ borderTop: '1px solid #374151', margin: '4px 0' }} />\r\n\r\n          <MetricRow label=\"Event Loop Score\" value={`${eventLoopHealth.score}/100`} warn={eventLoopHealth.score < 60} />\r\n          <MetricRow label=\"Current Lag\" value={`${eventLoopHealth.currentLag}ms`} warn={eventLoopHealth.currentLag > 50} />\r\n          <MetricRow label=\"Avg Lag\" value={`${eventLoopHealth.avgLag}ms`} />\r\n          <MetricRow label=\"Lag Spikes\" value={eventLoopHealth.lagSpikes} warn={eventLoopHealth.lagSpikes > 10} />\r\n\r\n          {perfMetrics.memoryUsage && (\r\n            <>\r\n              <div style={{ borderTop: '1px solid #374151', margin: '4px 0' }} />\r\n              <MetricRow label=\"JS Heap\" value={`${perfMetrics.memoryUsage.usedJSHeapSize}MB`} />\r\n            </>\r\n          )}\r\n\r\n          <div style={{ borderTop: '1px solid #374151', margin: '4px 0' }} />\r\n          <div style={{ fontSize: '10px', color: '#6b7280' }}>\r\n            Components: {Object.keys(perfMetrics.componentRenderCounts).length} tracked\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nconst MetricRow = memo(function MetricRow({ label, value, warn = false }) {\r\n  return (\r\n    <div style={{ display: 'flex', justifyContent: 'space-between' }}>\r\n      <span style={{ color: '#9ca3af' }}>{label}</span>\r\n      <span style={{ color: warn ? '#ef4444' : '#d1d5db', fontWeight: warn ? 'bold' : 'normal' }}>\r\n        {value}\r\n      </span>\r\n    </div>\r\n  );\r\n});\r\n\r\nexport { PerformanceOverlay };\r\n","/**\r\n * WebSocketManager - Full lifecycle management for WebSocket connections.\r\n * Handles connection, authentication, heartbeat, reconnection, message queuing,\r\n * serialization, and proper cleanup.\r\n *\r\n * Competency: WebSocket Real-time Communication\r\n */\r\n\r\nconst WS_STATES = {\r\n  CONNECTING: 0,\r\n  OPEN: 1,\r\n  CLOSING: 2,\r\n  CLOSED: 3,\r\n};\r\n\r\nclass WebSocketManager {\r\n  constructor(url, options = {}) {\r\n    this.url = url;\r\n    this.options = {\r\n      protocols: options.protocols || [],\r\n      authToken: options.authToken || null,\r\n      maxReconnectAttempts: options.maxReconnectAttempts || 10,\r\n      baseReconnectDelay: options.baseReconnectDelay || 1000,\r\n      maxReconnectDelay: options.maxReconnectDelay || 30000,\r\n      heartbeatInterval: options.heartbeatInterval || 30000,\r\n      heartbeatTimeout: options.heartbeatTimeout || 5000,\r\n      maxQueueSize: options.maxQueueSize || 100,\r\n      enableBinary: options.enableBinary || false,\r\n      onOpen: options.onOpen || null,\r\n      onClose: options.onClose || null,\r\n      onError: options.onError || null,\r\n      onMessage: options.onMessage || null,\r\n      onAuthSuccess: options.onAuthSuccess || null,\r\n      onAuthFailed: options.onAuthFailed || null,\r\n      onReconnecting: options.onReconnecting || null,\r\n    };\r\n\r\n    this.ws = null;\r\n    this.state = WS_STATES.CLOSED;\r\n    this.reconnectAttempts = 0;\r\n    this.reconnectTimer = null;\r\n    this.heartbeatTimer = null;\r\n    this.heartbeatTimeoutTimer = null;\r\n    this.messageQueue = [];\r\n    this.messageHandlers = new Map();\r\n    this.pendingMessages = new Map();\r\n    this.messageIdCounter = 0;\r\n    this.isIntentionallyClosed = false;\r\n    this.authenticated = false;\r\n    this.connectionId = null;\r\n    this.lastHeartbeatAt = null;\r\n    this.heartbeatMissCount = 0;\r\n    this.messageSequence = 0;\r\n    this.outOfOrderCount = 0;\r\n    this.lastReceivedSequence = -1;\r\n  }\r\n\r\n  connect() {\r\n    if (this.ws && (this.state === WS_STATES.CONNECTING || this.state === WS_STATES.OPEN)) {\r\n      console.warn('[WSManager] Already connected or connecting');\r\n      return;\r\n    }\r\n\r\n    this.isIntentionallyClosed = false;\r\n    this.state = WS_STATES.CONNECTING;\r\n\r\n    try {\r\n      this.ws = new WebSocket(this.url, this.options.protocols);\r\n\r\n      if (this.options.enableBinary) {\r\n        this.ws.binaryType = 'arraybuffer';\r\n      }\r\n\r\n      this.ws.onopen = this._handleOpen.bind(this);\r\n      this.ws.onclose = this._handleClose.bind(this);\r\n      this.ws.onerror = this._handleError.bind(this);\r\n      this.ws.onmessage = this._handleMessage.bind(this);\r\n    } catch (err) {\r\n      console.error('[WSManager] Connection error:', err);\r\n      this._scheduleReconnect();\r\n    }\r\n  }\r\n\r\n  disconnect(code = 1000, reason = 'Client disconnect') {\r\n    this.isIntentionallyClosed = true;\r\n    this._clearTimers();\r\n\r\n    if (this.ws) {\r\n      this.state = WS_STATES.CLOSING;\r\n      this.ws.close(code, reason);\r\n    }\r\n\r\n    this.authenticated = false;\r\n    this.connectionId = null;\r\n    this.state = WS_STATES.CLOSED;\r\n  }\r\n\r\n  send(type, payload = {}) {\r\n    const message = {\r\n      id: `msg-${++this.messageIdCounter}`,\r\n      type,\r\n      payload,\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    if (this.ws && this.ws.readyState === WS_STATES.OPEN) {\r\n      this._sendRaw(message);\r\n    } else {\r\n      this._enqueueMessage(message);\r\n    }\r\n\r\n    return message.id;\r\n  }\r\n\r\n  sendBinary(data) {\r\n    if (!this.options.enableBinary) {\r\n      console.warn('[WSManager] Binary mode not enabled');\r\n      return;\r\n    }\r\n\r\n    if (this.ws && this.ws.readyState === WS_STATES.OPEN) {\r\n      const buffer = data instanceof ArrayBuffer ? data : new TextEncoder().encode(JSON.stringify(data)).buffer;\r\n      this.ws.send(buffer);\r\n    }\r\n  }\r\n\r\n  subscribe(type, handler) {\r\n    if (!this.messageHandlers.has(type)) {\r\n      this.messageHandlers.set(type, new Set());\r\n    }\r\n    this.messageHandlers.get(type).add(handler);\r\n\r\n    return () => {\r\n      const handlers = this.messageHandlers.get(type);\r\n      if (handlers) {\r\n        handlers.delete(handler);\r\n        if (handlers.size === 0) {\r\n          this.messageHandlers.delete(type);\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  getState() {\r\n    return {\r\n      connected: this.state === WS_STATES.OPEN,\r\n      authenticated: this.authenticated,\r\n      connectionId: this.connectionId,\r\n      reconnectAttempts: this.reconnectAttempts,\r\n      queuedMessages: this.messageQueue.length,\r\n      state: this.state,\r\n      lastHeartbeatAt: this.lastHeartbeatAt,\r\n      heartbeatMissCount: this.heartbeatMissCount,\r\n      messageSequence: this.messageSequence,\r\n      outOfOrderCount: this.outOfOrderCount,\r\n    };\r\n  }\r\n\r\n  // Private methods\r\n\r\n  _handleOpen() {\r\n    console.log('[WSManager] Connected');\r\n    this.state = WS_STATES.OPEN;\r\n    this.reconnectAttempts = 0;\r\n\r\n    this._flushQueue();\r\n    this._startHeartbeatMonitor();\r\n\r\n    if (this.options.onOpen) {\r\n      this.options.onOpen();\r\n    }\r\n  }\r\n\r\n  _handleClose(event) {\r\n    console.log(`[WSManager] Closed (code: ${event.code}, reason: ${event.reason})`);\r\n    this.state = WS_STATES.CLOSED;\r\n    this.authenticated = false;\r\n    this._clearTimers();\r\n\r\n    if (this.options.onClose) {\r\n      this.options.onClose(event);\r\n    }\r\n\r\n    if (!this.isIntentionallyClosed) {\r\n      this._scheduleReconnect();\r\n    }\r\n  }\r\n\r\n  _handleError(error) {\r\n    console.error('[WSManager] Error:', error);\r\n\r\n    if (this.options.onError) {\r\n      this.options.onError(error);\r\n    }\r\n  }\r\n\r\n  _handleMessage(event) {\r\n    let message;\r\n\r\n    if (event.data instanceof ArrayBuffer) {\r\n      const text = new TextDecoder().decode(event.data);\r\n      try {\r\n        message = JSON.parse(text);\r\n      } catch {\r\n        this._notifyHandlers('binary', event.data);\r\n        return;\r\n      }\r\n    } else {\r\n      try {\r\n        message = JSON.parse(event.data);\r\n      } catch (err) {\r\n        console.error('[WSManager] Failed to parse message:', err);\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Handle internal message types\r\n    switch (message.type) {\r\n      case 'connection:established':\r\n        this.connectionId = message.payload?.clientId;\r\n        if (this.options.authToken) {\r\n          this.send('auth:token', { token: this.options.authToken });\r\n        }\r\n        break;\r\n\r\n      case 'auth:required':\r\n        if (this.options.authToken) {\r\n          this.send('auth:token', { token: this.options.authToken });\r\n        }\r\n        break;\r\n\r\n      case 'auth:success':\r\n        this.authenticated = true;\r\n        if (this.options.onAuthSuccess) {\r\n          this.options.onAuthSuccess(message.payload);\r\n        }\r\n        break;\r\n\r\n      case 'auth:failed':\r\n        this.authenticated = false;\r\n        if (this.options.onAuthFailed) {\r\n          this.options.onAuthFailed(message.payload);\r\n        }\r\n        break;\r\n\r\n      case 'heartbeat:ping':\r\n        this.send('heartbeat:pong', { timestamp: Date.now() });\r\n        this._resetHeartbeatTimeout();\r\n        this.lastHeartbeatAt = Date.now();\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n\r\n    // Notify type-specific handlers\r\n    this._notifyHandlers(message.type, message.payload);\r\n\r\n    // Notify global message handler\r\n    if (this.options.onMessage) {\r\n      this.options.onMessage(message);\r\n    }\r\n  }\r\n\r\n  _notifyHandlers(type, payload) {\r\n    const handlers = this.messageHandlers.get(type);\r\n    if (handlers) {\r\n      handlers.forEach((handler) => {\r\n        try {\r\n          handler(payload);\r\n        } catch (err) {\r\n          console.error(`[WSManager] Handler error for ${type}:`, err);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  _sendRaw(message) {\r\n    try {\r\n      this.ws.send(JSON.stringify(message));\r\n    } catch (err) {\r\n      console.error('[WSManager] Send error:', err);\r\n      this._enqueueMessage(message);\r\n    }\r\n  }\r\n\r\n  _enqueueMessage(message) {\r\n    if (this.messageQueue.length >= this.options.maxQueueSize) {\r\n      console.warn('[WSManager] Message queue overflow, dropping oldest message');\r\n      this.messageQueue.shift();\r\n    }\r\n    this.messageQueue.push(message);\r\n  }\r\n\r\n  _flushQueue() {\r\n    while (this.messageQueue.length > 0 && this.ws?.readyState === WS_STATES.OPEN) {\r\n      const message = this.messageQueue.shift();\r\n      this._sendRaw(message);\r\n    }\r\n  }\r\n\r\n  _scheduleReconnect() {\r\n    if (this.reconnectAttempts >= this.options.maxReconnectAttempts) {\r\n      console.error('[WSManager] Max reconnect attempts reached');\r\n      return;\r\n    }\r\n\r\n    this.reconnectAttempts++;\r\n\r\n    // Exponential backoff with jitter\r\n    const delay = Math.min(\r\n      this.options.baseReconnectDelay * Math.pow(2, this.reconnectAttempts - 1) +\r\n        Math.random() * 1000,\r\n      this.options.maxReconnectDelay\r\n    );\r\n\r\n    console.log(\r\n      `[WSManager] Reconnecting in ${Math.round(delay)}ms (attempt ${this.reconnectAttempts}/${this.options.maxReconnectAttempts})`\r\n    );\r\n\r\n    if (this.options.onReconnecting) {\r\n      this.options.onReconnecting(this.reconnectAttempts, delay);\r\n    }\r\n\r\n    this.reconnectTimer = setTimeout(() => {\r\n      this.connect();\r\n    }, delay);\r\n  }\r\n\r\n  /**\r\n   * Heartbeat monitor - detects if server stops sending pings.\r\n   * Bug surface: heartbeat timeout, missed heartbeats, stale connection detection\r\n   */\r\n  _startHeartbeatMonitor() {\r\n    this._clearHeartbeatTimeout();\r\n    this.heartbeatMissCount = 0;\r\n    this.lastHeartbeatAt = Date.now();\r\n\r\n    // Check periodically if heartbeat has been received\r\n    this.heartbeatTimer = setInterval(() => {\r\n      if (!this.lastHeartbeatAt) return;\r\n\r\n      const elapsed = Date.now() - this.lastHeartbeatAt;\r\n      if (elapsed > this.options.heartbeatInterval + this.options.heartbeatTimeout) {\r\n        this.heartbeatMissCount++;\r\n        console.warn(`[WSManager] Heartbeat missed (${this.heartbeatMissCount} total)`);\r\n        this._notifyHandlers('heartbeat:missed', {\r\n          missCount: this.heartbeatMissCount,\r\n          lastHeartbeatAt: this.lastHeartbeatAt,\r\n          elapsed,\r\n        });\r\n\r\n        // After 3 missed heartbeats, consider connection dead\r\n        if (this.heartbeatMissCount >= 3) {\r\n          console.error('[WSManager] Connection appears dead (3 missed heartbeats)');\r\n          this._notifyHandlers('heartbeat:dead', {\r\n            missCount: this.heartbeatMissCount,\r\n          });\r\n          this.ws?.close(4000, 'Heartbeat timeout');\r\n        }\r\n      }\r\n    }, this.options.heartbeatInterval);\r\n  }\r\n\r\n  _resetHeartbeatTimeout() {\r\n    this.heartbeatMissCount = 0;\r\n  }\r\n\r\n  _clearHeartbeatTimeout() {\r\n    clearTimeout(this.heartbeatTimeoutTimer);\r\n    this.heartbeatTimeoutTimer = null;\r\n  }\r\n\r\n  /**\r\n   * Track message sequence to detect out-of-order delivery.\r\n   * Bug surface: message ordering, lost messages, duplicate detection\r\n   */\r\n  trackMessageSequence(sequenceNum) {\r\n    this.messageSequence++;\r\n    if (sequenceNum !== undefined && sequenceNum <= this.lastReceivedSequence) {\r\n      this.outOfOrderCount++;\r\n    }\r\n    if (sequenceNum !== undefined) {\r\n      this.lastReceivedSequence = sequenceNum;\r\n    }\r\n  }\r\n\r\n  _clearTimers() {\r\n    clearTimeout(this.reconnectTimer);\r\n    clearInterval(this.heartbeatTimer);\r\n    clearTimeout(this.heartbeatTimeoutTimer);\r\n    this.reconnectTimer = null;\r\n    this.heartbeatTimer = null;\r\n    this.heartbeatTimeoutTimer = null;\r\n  }\r\n\r\n  destroy() {\r\n    this.disconnect();\r\n    this.messageHandlers.clear();\r\n    this.messageQueue = [];\r\n    this.pendingMessages.clear();\r\n  }\r\n}\r\n\r\nexport { WebSocketManager, WS_STATES };\r\n","/**\r\n * useWebSocket - React hook for WebSocket connection management.\r\n *\r\n * Competency: React Hook Dependencies, WebSocket Real-time Communication\r\n * Bug surface: stale closures, missing cleanup, dependency referential inequality,\r\n *              effect timing, memory leaks, closure capturing stale state\r\n */\r\n\r\nimport { useState, useEffect, useRef, useCallback, useMemo } from 'react';\r\nimport { WebSocketManager } from '../services/websocket/WebSocketManager';\r\n\r\nconst EMPTY_PROTOCOLS = [];\r\n\r\nfunction useWebSocket(url, options = {}) {\r\n  const {\r\n    authToken = null,\r\n    autoConnect = true,\r\n    onMessage = null,\r\n    onOpen = null,\r\n    onClose = null,\r\n    onError = null,\r\n    protocols = EMPTY_PROTOCOLS,\r\n    reconnectAttempts = 10,\r\n  } = options;\r\n\r\n  const [connectionState, setConnectionState] = useState({\r\n    connected: false,\r\n    authenticated: false,\r\n    reconnecting: false,\r\n    reconnectAttempt: 0,\r\n    error: null,\r\n  });\r\n\r\n  const [lastMessage, setLastMessage] = useState(null);\r\n\r\n  // Use refs for callbacks to prevent stale closures\r\n  const onMessageRef = useRef(onMessage);\r\n  const onOpenRef = useRef(onOpen);\r\n  const onCloseRef = useRef(onClose);\r\n  const onErrorRef = useRef(onError);\r\n\r\n  // Keep refs in sync without causing re-effects\r\n  useEffect(() => {\r\n    onMessageRef.current = onMessage;\r\n  }, [onMessage]);\r\n\r\n  useEffect(() => {\r\n    onOpenRef.current = onOpen;\r\n  }, [onOpen]);\r\n\r\n  useEffect(() => {\r\n    onCloseRef.current = onClose;\r\n  }, [onClose]);\r\n\r\n  useEffect(() => {\r\n    onErrorRef.current = onError;\r\n  }, [onError]);\r\n\r\n  // Stable reference for manager\r\n  const managerRef = useRef(null);\r\n\r\n  // Memoize the config to avoid dependency changes\r\n  const wsConfig = useMemo(\r\n    () => ({\r\n      authToken,\r\n      protocols,\r\n      maxReconnectAttempts: reconnectAttempts,\r\n      onOpen: () => {\r\n        setConnectionState((prev) => ({\r\n          ...prev,\r\n          connected: true,\r\n          reconnecting: false,\r\n          reconnectAttempt: 0,\r\n          error: null,\r\n        }));\r\n        if (onOpenRef.current) onOpenRef.current();\r\n      },\r\n      onClose: (event) => {\r\n        setConnectionState((prev) => ({\r\n          ...prev,\r\n          connected: false,\r\n          authenticated: false,\r\n        }));\r\n        if (onCloseRef.current) onCloseRef.current(event);\r\n      },\r\n      onError: (error) => {\r\n        setConnectionState((prev) => ({ ...prev, error }));\r\n        if (onErrorRef.current) onErrorRef.current(error);\r\n      },\r\n      onMessage: (message) => {\r\n        setLastMessage(message);\r\n        if (onMessageRef.current) onMessageRef.current(message);\r\n      },\r\n      onAuthSuccess: () => {\r\n        setConnectionState((prev) => ({ ...prev, authenticated: true }));\r\n      },\r\n      onAuthFailed: () => {\r\n        setConnectionState((prev) => ({\r\n          ...prev,\r\n          authenticated: false,\r\n          error: new Error('Authentication failed'),\r\n        }));\r\n      },\r\n      onReconnecting: (attempt) => {\r\n        setConnectionState((prev) => ({\r\n          ...prev,\r\n          reconnecting: true,\r\n          reconnectAttempt: attempt,\r\n        }));\r\n      },\r\n    }),\r\n    [authToken, protocols, reconnectAttempts]\r\n  );\r\n\r\n  // Create and manage WebSocket connection\r\n  useEffect(() => {\r\n    if (!url) return;\r\n\r\n    const manager = new WebSocketManager(url, wsConfig);\r\n    managerRef.current = manager;\r\n\r\n    if (autoConnect) {\r\n      manager.connect();\r\n    }\r\n\r\n    // Cleanup on unmount or URL change\r\n    return () => {\r\n      manager.destroy();\r\n      managerRef.current = null;\r\n    };\r\n  }, [url, wsConfig, autoConnect]);\r\n\r\n  // Stable send function\r\n  const send = useCallback((type, payload) => {\r\n    if (managerRef.current) {\r\n      return managerRef.current.send(type, payload);\r\n    }\r\n    console.warn('[useWebSocket] Cannot send: not connected');\r\n    return null;\r\n  }, []);\r\n\r\n  // Stable subscribe function\r\n  const subscribe = useCallback((messageType, handler) => {\r\n    if (managerRef.current) {\r\n      return managerRef.current.subscribe(messageType, handler);\r\n    }\r\n    return () => {};\r\n  }, []);\r\n\r\n  // Stable connect/disconnect\r\n  const connect = useCallback(() => {\r\n    if (managerRef.current) {\r\n      managerRef.current.connect();\r\n    }\r\n  }, []);\r\n\r\n  const disconnect = useCallback(() => {\r\n    if (managerRef.current) {\r\n      managerRef.current.disconnect();\r\n    }\r\n  }, []);\r\n\r\n  const getState = useCallback(() => {\r\n    if (managerRef.current) {\r\n      return managerRef.current.getState();\r\n    }\r\n    return null;\r\n  }, []);\r\n\r\n  return {\r\n    ...connectionState,\r\n    lastMessage,\r\n    send,\r\n    subscribe,\r\n    connect,\r\n    disconnect,\r\n    getState,\r\n  };\r\n}\r\n\r\nexport { useWebSocket };\r\n","/**\r\n * WebSocketContext - Provides WebSocket state and methods to the component tree.\r\n *\r\n * Competency: WebSocket Real-time Communication, React Component Suspense Management\r\n * Bug surface: context not integrating with suspense, stale context values\r\n */\r\n\r\nimport React, { createContext, useContext, useMemo, useCallback, useState } from 'react';\r\nimport { useWebSocket } from '../hooks/useWebSocket';\r\n\r\nconst WebSocketContext = createContext(null);\r\n\r\nfunction WebSocketProvider({ children, url, authToken }) {\r\n  const [messages, setMessages] = useState([]);\r\n\r\n  const handleMessage = useCallback((message) => {\r\n    setMessages((prev) => {\r\n      const updated = [...prev, message];\r\n      // Keep only last 200 messages to prevent memory growth\r\n      return updated.length > 200 ? updated.slice(-200) : updated;\r\n    });\r\n  }, []);\r\n\r\n  const ws = useWebSocket(url, {\r\n    authToken,\r\n    autoConnect: true,\r\n    onMessage: handleMessage,\r\n  });\r\n\r\n  const clearMessages = useCallback(() => {\r\n    setMessages([]);\r\n  }, []);\r\n\r\n  const value = useMemo(\r\n    () => ({\r\n      ...ws,\r\n      messages,\r\n      clearMessages,\r\n    }),\r\n    [ws, messages, clearMessages]\r\n  );\r\n\r\n  return (\r\n    <WebSocketContext.Provider value={value}>\r\n      {children}\r\n    </WebSocketContext.Provider>\r\n  );\r\n}\r\n\r\nfunction useWebSocketContext() {\r\n  const context = useContext(WebSocketContext);\r\n  if (!context) {\r\n    throw new Error('useWebSocketContext must be used within a WebSocketProvider');\r\n  }\r\n  return context;\r\n}\r\n\r\nexport { WebSocketProvider, useWebSocketContext, WebSocketContext };\r\n","/**\r\n * CacheContext - Provides cache manager to the component tree.\r\n *\r\n * Competency: API Response Caching\r\n * Bug surface: incorrect context API implementation, stale context values\r\n */\r\n\r\nimport React, { createContext, useContext, useMemo, useCallback, useState } from 'react';\r\nimport { CacheManager } from '../services/cache/CacheManager';\r\nimport { CacheInvalidator } from '../services/cache/invalidation';\r\n\r\nconst CacheContext = createContext(null);\r\n\r\nfunction CacheProvider({ children, options = {} }) {\r\n  const [, forceUpdate] = useState(0);\r\n\r\n  const cache = useMemo(\r\n    () => new CacheManager(options),\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    []\r\n  );\r\n\r\n  const invalidator = useMemo(() => {\r\n    const inv = new CacheInvalidator(cache);\r\n\r\n    // Register common mutation rules\r\n    inv.registerMutationRule('users', 'create', ['collection:users']);\r\n    inv.registerMutationRule('users', 'update', [\r\n      'collection:users',\r\n      (payload) => `user:${payload.id}`,\r\n    ]);\r\n    inv.registerMutationRule('users', 'delete', [\r\n      'collection:users',\r\n      (payload) => `user:${payload.id}`,\r\n    ]);\r\n\r\n    return inv;\r\n  }, [cache]);\r\n\r\n  const invalidateAndRefresh = useCallback(\r\n    (resourceType, mutationType, payload) => {\r\n      invalidator.onMutation(resourceType, mutationType, payload);\r\n      forceUpdate((n) => n + 1);\r\n    },\r\n    [invalidator]\r\n  );\r\n\r\n  const value = useMemo(\r\n    () => ({\r\n      cache,\r\n      invalidator,\r\n      invalidateAndRefresh,\r\n      getStats: () => cache.getStats(),\r\n    }),\r\n    [cache, invalidator, invalidateAndRefresh]\r\n  );\r\n\r\n  return (\r\n    <CacheContext.Provider value={value}>\r\n      {children}\r\n    </CacheContext.Provider>\r\n  );\r\n}\r\n\r\nfunction useCacheContext() {\r\n  const context = useContext(CacheContext);\r\n  if (!context) {\r\n    throw new Error('useCacheContext must be used within a CacheProvider');\r\n  }\r\n  return context;\r\n}\r\n\r\nexport { CacheProvider, useCacheContext, CacheContext };\r\n","/**\r\n * App - Root component with top-level Suspense boundary, Router, and Context providers.\r\n *\r\n * Competency: React Suspense Implementation, React Component Suspense Management\r\n * Bug surface: suspense with react strict mode, suspense boundary placement,\r\n *              context integration with suspense, missing error boundary,\r\n *              concurrent rendering, SSR considerations\r\n */\r\n\r\nimport React, { Suspense, lazy } from 'react';\r\nimport { BrowserRouter, Routes, Route, Link, useLocation } from 'react-router-dom';\r\nimport { ErrorBoundary } from './components/common/ErrorBoundary';\r\nimport { SuspenseBoundary } from './components/common/SuspenseBoundary';\r\nimport { SuspenseFallback } from './components/common/SuspenseFallback';\r\nimport { PerformanceOverlay } from './components/common/PerformanceOverlay';\r\nimport { WebSocketProvider } from './context/WebSocketContext';\r\nimport { CacheProvider } from './context/CacheContext';\r\nimport { PerformanceProvider } from './context/PerformanceContext';\r\n\r\nconst WS_URL = `ws://${window.location.hostname}:3001/ws`;\r\nconst AUTH_TOKEN = 'valid-auth-token-2024';\r\n\r\n// Lazy load all pages - each becomes a separate bundle chunk\r\nconst DashboardPage = lazy(() => import('./pages/DashboardPage'));\r\nconst LiveFeedPage = lazy(() => import('./pages/LiveFeedPage'));\r\nconst UsersPage = lazy(() => import('./pages/UsersPage'));\r\nconst AnalyticsPage = lazy(() => import('./pages/AnalyticsPage'));\r\nconst SettingsPage = lazy(() => import('./pages/SettingsPage'));\r\n\r\nfunction AppLayout({ children }) {\r\n  const location = useLocation();\r\n\r\n  return (\r\n    <div style={{ display: 'flex', minHeight: '100vh', fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif' }}>\r\n      <Sidebar currentPath={location.pathname} />\r\n      <main style={{ flex: 1, backgroundColor: '#f9fafb', overflow: 'auto' }}>\r\n        {children}\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Sidebar({ currentPath }) {\r\n  const navItems = [\r\n    { path: '/', label: 'Dashboard', icon: '📊' },\r\n    { path: '/feed', label: 'Live Feed', icon: '📡' },\r\n    { path: '/users', label: 'Users', icon: '👥' },\r\n    { path: '/analytics', label: 'Analytics', icon: '📈' },\r\n    { path: '/settings', label: 'Settings', icon: '⚙️' },\r\n  ];\r\n\r\n  return (\r\n    <nav style={{\r\n      width: '220px',\r\n      backgroundColor: '#111827',\r\n      color: '#e5e7eb',\r\n      padding: '20px 0',\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n      flexShrink: 0,\r\n    }}>\r\n      <div style={{\r\n        padding: '0 20px 20px',\r\n        borderBottom: '1px solid #1f2937',\r\n        marginBottom: '10px',\r\n      }}>\r\n        <h1 style={{ margin: 0, fontSize: '18px', fontWeight: '700', color: 'white' }}>\r\n          Analytics Hub\r\n        </h1>\r\n        <p style={{ margin: '4px 0 0', fontSize: '12px', color: '#6b7280' }}>\r\n          Real-time Dashboard\r\n        </p>\r\n      </div>\r\n\r\n      <div style={{ display: 'flex', flexDirection: 'column', gap: '2px', padding: '0 8px' }}>\r\n        {navItems.map((item) => {\r\n          const isActive = currentPath === item.path;\r\n          return (\r\n            <Link\r\n              key={item.path}\r\n              to={item.path}\r\n              style={{\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                gap: '10px',\r\n                padding: '10px 12px',\r\n                borderRadius: '6px',\r\n                color: isActive ? 'white' : '#9ca3af',\r\n                backgroundColor: isActive ? '#1f2937' : 'transparent',\r\n                textDecoration: 'none',\r\n                fontSize: '14px',\r\n                fontWeight: isActive ? '500' : '400',\r\n                transition: 'all 0.1s',\r\n              }}\r\n            >\r\n              <span style={{ fontSize: '16px' }}>{item.icon}</span>\r\n              {item.label}\r\n            </Link>\r\n          );\r\n        })}\r\n      </div>\r\n    </nav>\r\n  );\r\n}\r\n\r\n/**\r\n * Wraps lazy-loaded routes with route-level Suspense boundaries.\r\n */\r\nfunction LazyRoute({ children }) {\r\n  return (\r\n    <SuspenseBoundary\r\n      fallback={<SuspenseFallback level=\"page\" message=\"Loading page...\" />}\r\n      level=\"page\"\r\n    >\r\n      {children}\r\n    </SuspenseBoundary>\r\n  );\r\n}\r\n\r\nfunction App() {\r\n  return (\r\n    <React.StrictMode>\r\n      {/* Top-level Error Boundary */}\r\n      <ErrorBoundary\r\n        fallback={({ error, reset }) => (\r\n          <div style={{\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            minHeight: '100vh',\r\n            padding: '40px',\r\n          }}>\r\n            <h1 style={{ color: '#dc2626' }}>Application Error</h1>\r\n            <p style={{ color: '#6b7280' }}>{error?.message}</p>\r\n            <button\r\n              onClick={reset}\r\n              style={{\r\n                padding: '10px 24px',\r\n                backgroundColor: '#3b82f6',\r\n                color: 'white',\r\n                border: 'none',\r\n                borderRadius: '8px',\r\n                cursor: 'pointer',\r\n                fontSize: '14px',\r\n              }}\r\n            >\r\n              Reload Application\r\n            </button>\r\n          </div>\r\n        )}\r\n      >\r\n        {/* Top-level Suspense Boundary */}\r\n        <Suspense fallback={<SuspenseFallback level=\"page\" message=\"Loading application...\" />}>\r\n          <BrowserRouter>\r\n            {/* Context Providers - inside Router so routes can access them */}\r\n            <PerformanceProvider trackingEnabled={true}>\r\n              <CacheProvider options={{ maxEntries: 200, defaultTTL: 60000 }}>\r\n                <WebSocketProvider url={WS_URL} authToken={AUTH_TOKEN}>\r\n                  <AppLayout>\r\n                    <Routes>\r\n                      <Route path=\"/\" element={<LazyRoute><DashboardPage /></LazyRoute>} />\r\n                      <Route path=\"/feed\" element={<LazyRoute><LiveFeedPage /></LazyRoute>} />\r\n                      <Route path=\"/users\" element={<LazyRoute><UsersPage /></LazyRoute>} />\r\n                      <Route path=\"/analytics\" element={<LazyRoute><AnalyticsPage /></LazyRoute>} />\r\n                      <Route path=\"/settings\" element={<LazyRoute><SettingsPage /></LazyRoute>} />\r\n                    </Routes>\r\n                  </AppLayout>\r\n                  <PerformanceOverlay />\r\n                </WebSocketProvider>\r\n              </CacheProvider>\r\n            </PerformanceProvider>\r\n          </BrowserRouter>\r\n        </Suspense>\r\n      </ErrorBoundary>\r\n    </React.StrictMode>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom/client';\r\nimport App from './App';\r\nimport './styles/global.css';\r\n\r\nconst root = ReactDOM.createRoot(document.getElementById('root'));\r\nroot.render(<App />);\r\n"],"file":"assets/index-BatblRAa.js"}