import{r as t}from"./vendor-react-BShjbBE1.js";import{c as x,C as F,s as M,n as T}from"./shared-services-ARmQ2z6X.js";const s=new F({maxEntries:200,defaultTTL:6e4});function O(g,E={}){const{cacheKey:r,strategy:m="cache-first",ttl:w=6e4,tags:S=[],enabled:b=!0,onSuccess:k=null,onError:p=null,staleTime:q=0}=E,[y,c]=t.useState({data:null,error:null,isLoading:!1,isStale:!1,source:null}),C=t.useRef(g);C.current=g;const o=t.useRef(k),l=t.useRef(p);o.current=k,l.current=p;const n=t.useMemo(()=>({ttl:w,tags:S}),[w,JSON.stringify(S)]),u=t.useRef(0),a=t.useRef(!0);t.useEffect(()=>(a.current=!0,()=>{a.current=!1}),[]);const i=t.useCallback(async()=>{if(!r)return;const d=++u.current;c(e=>({...e,isLoading:!0,error:null}));const h=()=>C.current();try{let e;switch(m){case"network-first":e=await T(s,r,h,n);break;case"stale-while-revalidate":e=M(s,r,h,{...n,onRevalidated:R=>{a.current&&u.current===d&&c(L=>({...L,data:R,isStale:!1,source:"network"}))}}),e instanceof Promise&&(e=await e);break;case"cache-first":default:e=await x(s,r,h,n);break}a.current&&u.current===d&&(c({data:e.data,error:null,isLoading:!1,isStale:e.stale||!1,source:e.source}),o.current&&o.current(e.data))}catch(e){if(e.name==="AbortError")return;a.current&&u.current===d&&(c(R=>({...R,error:e,isLoading:!1})),l.current&&l.current(e))}},[r,m,n]);t.useEffect(()=>{b&&r&&i()},[b,r,i]);const f=t.useCallback(()=>{r&&s.invalidate(r)},[r]),v=t.useCallback(()=>(f(),i()),[f,i]);return{...y,refetch:v,invalidate:f,cacheStats:s.getStats()}}export{s as g,O as u};
//# sourceMappingURL=useApiCache-DNLFDV80.js.map
